# 重大重构：分段成本记录与分析功能的实现

## 概述

为了获得更深层次的设计洞察力，我们成功实施了一项涉及两个核心脚本 (`adaptive_optimize.py` 和 `analyze_log_data.py`) 联动的重大功能升级。此功能旨在独立地记录和分析模型在不同频段下的性能表现。

## 实现细节

### 1. `adaptive_optimize.py` (数据记录器) 的改造

-   **动态日志列**: `setup_logging` 函数被重构，使其能够根据 `WIDEBAND_TARGETS` 的配置，在 `optimization_log.csv` 文件中自动生成新的、独立的成本列，例如 `Cost_0.0-28.0GHz`, `Cost_28.0-56.0GHz` 等。
-   **分段成本计算**: `evaluate_hfss` 函数的核心逻辑被修改。在 `wideband` 模式下，它现在会在计算总成本的同时，精确计算出S11曲线在每一个性能目标分段内的“违规面积”（即分段成本），并将这些值一一对应地记录到新的日志列中。
-   **优化目标不变**: 传递给优化器的总成本（`Cost`）仍然是所有分段成本的总和，确保了优化方向的全局性。

### 2. `analyze_log_data.py` (数据分析器) 的升级

-   **向后兼容的设计**: 新脚本的核心是动态的。它通过 `col.startswith('Cost')` 来自动检测日志文件中所有需要被分析的成本列。这使得它既能处理新的分段式日志，也能完美兼容旧的、只有单一成本的日志文件。
-   **循环式深度分析**: 脚本的主体被重构为一个循环。它会遍历所有检测到的成本列，并为**每一个成本维度**（总成本、低频成本、高频成本...）都独立地、完整地运行一遍全套的数据分析流程（敏感度排序、相关性热力图、参数散点图）。
-   **分层HTML报告**: 最终生成的HTML报告 (`analysis_report_zh_segmented.html`) 具有清晰的层级结构。它会为每一个成本维度的分析，都创建一个独立的、带大标题的章节，使得分析结果的组织和呈现一目了然。

## 结论

这次成功的重构，将我们的项目从一个单纯的“优化工具”，转变为一个强大的“设计洞察与分析平台”。它为理解参数在不同频段下的物理行为和性能取舍，提供了前所未有的数据支持。
